
#' R6 Class for handling a logical set of sequence data
#'
#' @description
#' `sequence_set` class provides an infrastructure for working with sets of
#' sequence that have been generated by the base calling software.
#'
#' @import R6
#' @import arrow
#'
#' @export
sequence_set <- R6::R6Class(
  classname = "sequence_set",

  public = list(
    #' @description
    #' Constructor method for `sequence_set` requires just a path to the
    #' cache_directory that will be populated with parquet files that
    #' summarise the sequence collection being processed
    #'
    #' @param cache_dir a fully qualified path to a cache directory
    initialize = function(basecalled_folder) {
      private$basecalled_folder <- basecalled_folder
    },

    #' @description
    #' allowing for the real time generation of sequence data and accommodating
    #' the background processing of indices, this method just pokes the system
    #' to ensure that the latest changes within the `cache_dir` are understood
    #' and that data held is up-to-date.
    sync = function() {
      return(private$get_arrow())
    },

    #' @description
    #' get the arrow data from the aggregate parquet file
    data = function() {
      return(arrow::read_parquet(
        get_arrow_path(private$basecalled_folder$get_cache_dir())))
    },

    as_summary = function() {
      return(rtqc::sequence_set_summary$new(sequence_set = self))
    },

    get_bc_folder = function() {
      return(private$basecalled_folder)
    }

  ),

  private = list(
    basecalled_folder = NULL,

    get_arrow = function() {
      form_arrow(private$basecalled_folder$get_cache_dir())
    }
  )

)
